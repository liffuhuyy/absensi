<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal</title>
    <link rel="shortcut icon" href="./assets/compiled/svg/favicon.svg" type="image/x-icon">
    <link rel="shortcut icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
        type="image/png">
    <link rel="stylesheet" href="assets/extensions/sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="./assets/compiled/css/app.css">
    <link rel="stylesheet" href="./assets/compiled/css/app-dark.css">
</head>
<style>
    label {
        font-weight: 600;
        display: block;
        margin-top: 15px;
        text-align: left;
        font-size: 14px;
    }

    input[type="time"],
    input[type="number"] {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #007bff;
        border-radius: 8px;
        font-size: 16px;
        background: white;
        color: black;
    }

    .days-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
        justify-content: center;
    }

    .days-container label {
        background: #007bff;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: 0.3s;
    }

    .days-container input[type="checkbox"] {
        display: none;
    }

    .days-container input[type="checkbox"]:checked+label {
        background: #28a745;
        transform: scale(1.1);
    }

    .btn {
        width: 100%;
        color: white;
        padding: 12px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 25px;
        font-size: 18px;
        font-weight: bold;
        transition: 0.3s;
    }

    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }

    input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
    }

    input:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }

    /* Gaya untuk tabel */
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .table th,
    .table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: center;
    }

    .table th {
        background-color: rgb(133, 214, 255);
    }

    /* Gaya untuk tombol */
    .btn-tambah {
        background-color: #007bff;
        border: none;
        color: white;
        padding: 10px 30px;
        text-align: center;
        text-decoration: none;
        display: block;
        margin: 20px auto;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s ease;
        min-width: 200px;
    }

    .btn-tambah:hover {
        background-color: rgb(42, 66, 91);
    }

    .btn {
        padding: 8px 12px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 5px;
        cursor: pointer;
        display: inline-block;
        width: 80px;
    }

    /* Tombol Edit (kuning) */
    .btn-warning {
        background-color: #ffc107;
        border: none;
        color: #fff;
    }

    /* Tombol Hapus (merah) */
    .btn-danger {
        background-color: #dc3545;
        border: none;
        color: #fff;
    }

    /* Efek hover */
    .btn:hover {
        opacity: 0.8;
    }

    /* Tata letak tombol di tabel */
    .action-buttons .btn-edit {
        background-color: #FFC107;
        /* Warna kuning */
        border-color: #FFA000;
        color: #000;
        /* Warna teks hitam agar kontras */
    }

    .action-buttons .btn-danger {
        background-color: #DC3545;
        /* Warna merah */
        border-color: #C82333;
        color: #fff;
        /* Warna teks putih agar kontras */
    }

    /* Efek hover agar lebih interaktif */
    .action-buttons .btn-edit:hover {
        background-color: #FFA000;
    }

    .action-buttons .btn-danger:hover {
        background-color: #C82333;
    }
</style>

<body>
    <script src="assets/static/js/initTheme.js"></script>
    @include('perusahaan.layout.sidebar')
    @include('perusahaan.layout.header')
    <div class="page-heading">
        <div class="page-title">
            <div class="row">
                <div class="col-12 col-md-6 order-md-1 order-last">
                    <h3>Jadwal Kerja Dan Titik</h3>
                    <p class="text-subtitle text-muted">Membuat jadwal kerja dan titik koordinat perusahaan.</p>
                </div>
                <div class="col-12 col-md-6 order-md-2 order-first">
                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ url('/dashboardpt') }}">Dashboard</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Jadwal</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <div class="page-content">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">

                        <body>
                            <form method="POST" action="{{ url('/jadwalpt/tambah') }}">
                                @csrf
                                <div id="jadwal-form">
                                    <label for="jam-masuk">Jam Masuk</label>
                                    <input type="time" id="jam-masuk" name="jam_masuk" required>

                                    <label for="jam-keluar">Jam Keluar</label>
                                    <input type="time" id="jam-keluar" name="jam_keluar" required>

                                    <label>Hari Kerja</label>
                                    <div class="days-container">
                                        <input type="checkbox" id="senin" name="hari_kerja[]" value="senin"><label
                                            for="senin">Senin</label>
                                        <input type="checkbox" id="selasa" name="hari_kerja[]" value="selasa"><label
                                            for="selasa">Selasa</label>
                                        <input type="checkbox" id="rabu" name="hari_kerja[]" value="rabu"><label
                                            for="rabu">Rabu</label>
                                        <input type="checkbox" id="kamis" name="hari_kerja[]" value="kamis"><label
                                            for="kamis">Kamis</label>
                                        <input type="checkbox" id="jumat" name="hari_kerja[]" value="jumat"><label
                                            for="jumat">Jumat</label>
                                        <input type="checkbox" id="sabtu" name="hari_kerja[]" value="sabtu"><label
                                            for="sabtu">Sabtu</label>
                                    </div>

                                    <label for="latitude">Latitude</label>
                                    <input type="text" id="latitude" name="latitude" placeholder="Masukkan latitude"
                                        required>

                                    <label for="longitude">Longitude</label>
                                    <input type="text" id="longitude" name="longitude"
                                        placeholder="Masukkan longitude" required>

                                    <button type="submit" class="btn-tambah">Tambah Jadwal</button>
                                </div>
                            </form>
                            <br>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Perusahaan</th>
                                        <th>Jam Masuk</th>
                                        <th>Jam Keluar</th>
                                        <th>Hari Kerja</th>
                                        <th>Latitude</th>
                                        <th>Longitude</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if ($jadwal)
                                        <tr>
                                            <td>{{ $jadwal->pengguna->nama ?? '' }}</td>
                                            <td>{{ $jadwal->jam_masuk }}</td>
                                            <td>{{ $jadwal->jam_keluar }}</td>
                                            <td>{{ implode(', ', json_decode($jadwal->hari_kerja)) }}</td>
                                            <td>{{ $jadwal->latitude }}</td>
                                            <td>{{ $jadwal->longitude }}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <!-- Tombol Edit -->
                                                    <button class="btn btn-warning btn-sm btn-edit"
                                                        data-id="{{ $jadwal->id }}">
                                                        Edit
                                                    </button>
                                                    <!-- Form Hapus -->
                                                    <form action="{{ route('jadwal.destroy', $jadwal->id) }}"
                                                        method="POST" style="display:inline;">
                                                        @csrf
                                                        @method('DELETE')
                                                        <button type="submit" class="btn btn-danger btn-sm"
                                                            onclick="return confirm('Yakin ingin menghapus?')">Hapus</button>
                                                    </form>
                                                </div>
                                            </td>
                                        @else
                                        <tr>
                                            <td colspan="6" class="text-center">Tidak ada jadwal kerja tersedia
                                            </td>
                                        </tr>
                                    @endif
                                </tbody>
                            </table>
                    </div>

                    <!-- Modal Edit -->
                    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <form id="editForm" method="POST">
                                @csrf
                                @method('PUT')
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Edit Jadwal</h5>
                                        <button type="button" class="close"
                                            data-dismiss="modal"><span>&times;</span></button>
                                    </div>
                                    <div class="modal-body">
                                        <input type="hidden" id="jadwal_id" name="id">

                                        <div class="form-group">
                                            <label for="jam_masuk">Jam Masuk</label>
                                            <input type="time" name="jam_masuk" id="jam_masuk"
                                                class="form-control" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="jam_keluar">Jam Keluar</label>
                                            <input type="time" name="jam_keluar" id="jam_keluar"
                                                class="form-control" required>
                                        </div>

                                        <div class="form-group">
                                            <label>Hari Kerja</label>
                                            <div class="days-container d-flex flex-wrap" id="hari_kerja_checkboxes">
                                                @foreach (['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'] as $hari)
                                                    <div class="form-check mr-3 mb-2">
                                                        <input type="checkbox" class="form-check-input"
                                                            id="hari_{{ $hari }}" name="hari_kerja[]"
                                                            value="{{ $hari }}">
                                                        <label class="form-check-label"
                                                            for="hari_{{ $hari }}">{{ ucfirst($hari) }}</label>
                                                    </div>
                                                @endforeach
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="latitude">Latitude</label>
                                            <input type="text" name="latitude" id="edit_latitude"
                                                class="form-control" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="longitude">Longitude</label>
                                            <input type="text" name="longitude" id="edit_longitude"
                                                class="form-control" required>
                                        </div>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">Simpan</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            @include('admin.layout.footer')
            <script src="assets/static/js/components/dark.js"></script>
            <script src="assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>
            <script src="assets/extensions/jquery/jquery.min.js"></script>
            <script src="assets/compiled/js/app.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="assets/extensions/sweetalert2/sweetalert2.all.min.js"></script>
            <script>
                $(document).ready(function() {
                    // Tombol Close Modal
                    $('.close').click(function() {
                        $('#editModal').modal('hide');
                    });

                    // Tombol Edit - Mengambil Data dari Server
                    $('.btn-edit').click(function() {
                        var id = $(this).data('id');

                        if (!id) {
                            alert("ID tidak ditemukan!");
                            return;
                        }

                        $.ajax({
                            url: '/jadwalpt/edit/' + id,
                            method: 'GET',
                            success: function(data) {
                                console.log("Data dari server:", data);
                                $('#editForm').attr('action', '/jadwalpt/update/' + id);

                                if ($('#edit_jam_masuk').length) {
                                    $('#edit_jam_masuk').val(data.jam_masuk);
                                } else {
                                    console.warn("Elemen #edit_jam_masuk tidak ditemukan.");
                                }
                                if ($('#edit_jam_keluar').length) $('#edit_jam_keluar').val(data
                                    .jam_keluar);
                                if ($('#edit_latitude').length) $('#edit_latitude').val(data.latitude ||
                                    '');
                                if ($('#edit_longitude').length) $('#edit_longitude').val(data
                                    .longitude || '');

                                // Uncheck semua checkbox hari kerja
                                $('input[name="hari_kerja[]"]').prop('checked', false);
                                if (Array.isArray(data.hari_kerja)) {
                                    data.hari_kerja.forEach(function(hari) {
                                        $('#hari_' + hari).prop('checked', true);
                                    });
                                }

                                $('#editModal').modal('show'); // Tampilkan modal setelah data diisi
                            },
                            error: function(xhr) {
                                console.log(xhr.responseText);
                                alert('Gagal memuat data.');
                            }
                        });
                    });

                    // Form Submit - Menyimpan Data ke Server
                    $('#editForm').submit(function(e) {
                        e.preventDefault(); // Hindari reload otomatis

                        let actionUrl = $('#editForm').attr('action');
                        let id = actionUrl.match(/(\d+)$/) ? actionUrl.match(/(\d+)$/)[0] : null;
                        let formData = $(this).serialize();

                        if (!id) {
                            console.error("ID tidak ditemukan!");
                            alert("Terjadi kesalahan: ID tidak valid.");
                            return;
                        }

                        $.ajax({
                            url: '/jadwalpt/update/' + id,
                            type: 'POST',
                            data: formData,
                            success: function(res) {
                                console.log("Response dari server:", res);
                                alert("Data berhasil diperbarui!");
                                $('#editModal').modal('hide');
                                location.reload();
                            },
                            error: function(xhr) {
                                console.error("Gagal menyimpan data:", xhr.status, xhr.responseText);
                                alert('Gagal menyimpan data.');
                            }

                        });
                    });

                    // Form Tambah Data
                    $('#jadwal-form').on('submit', function(e) {
                        e.preventDefault(); // Hindari pengiriman standar

                        $.ajax({
                            url: "/jadwalpt/tambah",
                            type: "POST",
                            data: $(this).serialize(),
                            beforeSend: function() {
                                $('#saveButton').prop('disabled', true).text('Menyimpan...');
                            },
                            success: function(response) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Sukses!',
                                    text: 'Jadwal berhasil ditambahkan!',
                                    showConfirmButton: false,
                                    timer: 1500
                                });
                                $('#jadwal-form')[0].reset(); // Reset formulir setelah sukses
                            },
                            error: function(xhr) {
                                let errorMsg = "Terjadi kesalahan, silakan coba lagi.";
                                if (xhr.responseText) {
                                    let response = JSON.parse(xhr.responseText);
                                    errorMsg = response.message ?? errorMsg;
                                }
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops!',
                                    text: errorMsg
                                });
                            },
                            complete: function() {
                                $('#saveButton').prop('disabled', false).text('Simpan');
                            }
                        });
                    });
                });
            </script>
</body>

</html>
